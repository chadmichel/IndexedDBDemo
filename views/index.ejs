<html xmlns="http://www.w3.org/1999/html">

<head>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>

<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet" />
<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>

<script src="tiny_mce/tiny_mce.js"></script>
<script src="tiny_mce/jquery.tinymce.js"></script>

<link href="stylesheets/style.css" rel="stylesheet" />

<script src="javascripts/notes.js"></script>

<script>


ko.bindingHandlers.tinymce = {

    init: function(element, valueAccessor, allBindingsAccessor) {

            var options = allBindingsAccessor().tinymceOptions || {};
            var modelValue = valueAccessor();

            //handle edits made in the editor
            options.setup = function(ed) {
                ed.onChange.add(function(ed, l) {
                    if (ko.isWriteableObservable(modelValue)) {
                       modelValue(l.content);
                    }
                });
            };

            //handle destroying an editor (based on what jQuery plugin does)
            ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
                $(element).parent().find("span.mceEditor,div.mceEditor").each(function(i, node) {
                    var ed = tinyMCE.get(node.id.replace(/_parent$/, ""));
                    if (ed) {
                        ed.remove();
                    }
                });
            });


            $(element).tinymce(options);

        },

    //update the control when the view model changes
    update: function(element, valueAccessor) {
        var value = ko.utils.unwrapObservable(valueAccessor());
        $(element).html(value);
    }
};

$(function() {


        //$('#noteBody').tinymce({
        //    // Location of TinyMCE script
        //    script_url : 'tiny_mce/tiny_mce.js'
        //});

    });


</script>

</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span2">
            <table class="table" data-bind="foreach: notes">
                <tr>
                    <td data-bind="text: title, click: $parent.load"></td>
                </tr>
            </table>
        </div>
        <div class="span10">
            <div>
                <button data-bind="click: create, enable: isNewEnabled" >Create</button>
                <button data-bind="click: save, enable: isSaveEnabled" >Save</button>
            </div>

            <div>

                <fieldset>

                    <label for="titleText">Title</label>
                    <input id="noteTitle" type="text" data-bind="value: activeTitle" />
                    <label for="bodyText">Body</label>
                    <textarea id="noteBody" class="tinymce" data-bind="tinymce: activeBody, tinymceOptions: { theme: 'advanced' }" />

                </fieldset>
            </div>
        </div>
    </div>
</div>

</body>

</html>
